<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <meta charset="utf-8" />
</head>
<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="http://d3js.org/d3-queue.v3.min.js" type="text/javascript"></script>
<style>
    .tick line {
        shape-rendering: crispEdges;
        stroke: #000;
    }

    line.minor  {
        stroke: #777;
        stroke-dasharray: 2,2;
    }

    path.domain {
        fill: none;
        stroke: black;
    }

    /* Style for Custom Tooltip */
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 60px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        background: white;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }

</style>
<body onload="adjacency()">

<form class="navbar-form navbar-right">
    <div class="form-group navbar-right">
        <select class="form-control" data-show-icon="true" id="selectPurpose" >
            <option value="HW">Home To Work</option>
            <option value="HH">Home To Home</option>
            <option value="HO">Home To Other</option>
            <option value="OW">Other To Work</option>
            <option value="OH">Other To Home</option>
            <option value="OO">Other To Other</option>
            <option value="WW">Work To Work</option>
            <option value="WH">Work To Home</option>
            <option value="WO">Work To Other</option>
        </select>
    </div>
</form>

<form class="navbar-form navbar-right">
    <div class="form-group navbar-right">
        <select class="form-control" data-show-icon="true" id="selectClass" >
            <option value="Short Term Visitor">Short Term Visitor</option>
            <option value="Home Worker">Home Worker</option>
            <option value="Inbound Commuter">Inbound Commuter</option>
            <option value="Outbound Commuter">Outbound Commuter</option>
            <option value="Resident Worker">Resident Worker</option>
            <option value="Long Term Visitor">Long Term Visitor</option>
        </select>
    </div>
</form>

<form class="navbar-form navbar-right">
    <div class="form-group navbar-right">
        <select class="form-control" data-show-icon="true" id="selectTime" >
            <option value="H04:H05">H04:H05</option>
            <option value="H05:H06">H05:H06</option>
            <option value="H06:H07">H06:H07</option>
            <option value="H07:H08">H07:H08</option>
            <option value="H08:H09">H08:H09</option>
            <option value="H09:H10">H09:H10</option>
            <option value="H10:H11">H10:H11</option>
            <option value="H11:H12">H11:H12</option>
            <option value="H12:H13">H12:H13</option>
            <option value="H13:H14">H13:H14</option>
            <option value="H14:H15">H14:H15</option>
            <option value="H15:H16">H15:H16</option>
            <option value="H16:H17">H16:H17</option>
            <option value="H17:H18">H17:H18</option>
            <option value="H18:H19">H18:H19</option>
            <option value="H19:H20">H19:H20</option>
            <option value="H20:H21">H20:H21</option>
            <option value="H21:H22">H21:H22</option>
            <option value="H22:H23">H22:H23</option>
            <option value="H23:H24">H23:H24</option>
        </select>
    </div>
</form>

<form class="navbar-form navbar-right">
    <div class="form-group navbar-right">
        <select class="form-control" data-show-icon="true" id="selectDay" >
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
        </select>
    </div>
</form>

<div id="vizcontainer">
    <svg style="width:2400px;height:2400px;border:1px lightgray solid;" />
</div>
<footer>
    <script>

        // Append Div for tooltip to SVG
        var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        var arr = []

        function adjacency(){
            d3.queue()
                .defer(d3.json, "nodelist_1.json")
                .await(function(error, file1) { createAdjacencyMatrix(file1); });

            function filterByID(obj)
            {
                //console.log(obj)

                if (obj.Purpose == "HO" && obj.Subscriber_Class == "Home Worker" && obj.Time_of_Day == "H04:H05")
                {
                    return true;
                }
                else
                {
                    return false;
                }
            }

            function createAdjacencyMatrix(edgelist)
            {
                var factor = 9;
                var edgeHash = {};
                var nodeList = [];

                var edgeFiltered = edgelist.filter(filterByID)

                for (x in edgeFiltered)
                {
                    var zone = edgeFiltered[x].Origin_Zone + "-" + edgeFiltered[x].Destination_Zone;
                    edgeHash[zone] = edgeFiltered[x];

                    if(!nodeList.includes(edgeFiltered[x].Origin_Zone))
                    {
                        nodeList.push(edgeFiltered[x].Origin_Zone)
                    }

                    if(!nodeList.includes(edgeFiltered[x].Destination_Zone))
                    {
                        nodeList.push(edgeFiltered[x].Destination_Zone)
                    }
                }

                nodeList.sort(function(a, b)
                {
                    return a-b
                })

                matrix = [];
                //create all possible edges
                for (a in nodeList)
                {
                    for (b in nodeList)
                    {
                        var grid = {zone: nodeList[a]+ "-" + nodeList[b], x: b, y: a, count: 0};
                        if (edgeHash[grid.zone]) {
                            grid.count = edgeHash[grid.zone].Count;
                        }
                        matrix.push(grid);
                    }
                }

                d3.select("svg")
                    .append("g")
                    .attr("transform", "translate(35,35)")
                    .attr("id", "adjacencyG")
                    .selectAll("rect")
                    .data(matrix)
                    .enter()
                    .append("rect")
                    .attr("width", factor)
                    .attr("height", factor)
                    .attr("x", function (d) {
                        return d.x * factor})
                    .attr("y", function (d) {
                        return d.y * factor})
                    .style("stroke", "black")
                    .style("stroke-width", "1px")
                    .style("fill", "red")
                    .style("fill-opacity", function (d) {
                        return d.count * .2
                    })
                    .on("mouseover", gridOver)


                var scaleSize = nodeList.length * factor;
                var nameScale = d3.scalePoint().domain(nodeList.map(function (el) {return el})).range([0,scaleSize],1);

                xAxis = d3.axisTop().scale(nameScale).tickSize(4);
                yAxis = d3.axisLeft(nameScale).tickSize(4);
                d3.select("#adjacencyG").append("g").call(xAxis).selectAll("text").style("text-anchor", "end").attr("transform", "translate(-10,-10) rotate(90)");
                d3.select("#adjacencyG").append("g").call(yAxis);

                function gridOver(d,i)
                {
                    d3.selectAll("rect").style("stroke-width", function (p) {return p.x == d.x || p.y == d.y ? "3px" : "1px"})
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.text(d.zone + " " + d.count)
                        .style("left", (d3.event.pageX + 10) + "px")
                        .style("top", (d3.event.pageY - 10) + "px");
                }
            }
        }
    </script>
</footer>
</body>
</html>